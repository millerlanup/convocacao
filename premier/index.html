
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Convoca√ß√£o - MBL</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .flap-badge {
            position: absolute;
            top: 10px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .section {
            padding: 20px;
            border-bottom: 1px solid #eee;
        }

        .section:last-child {
            border-bottom: none;
        }

        .section-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: #2c3e50;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 500;
            margin-bottom: 5px;
            color: #555;
        }

        input, select, textarea {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd8;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .controls-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            gap: 15px;
            flex-wrap: wrap;
        }

        .controls-left {
            display: flex;
            gap: 10px;
            flex: 1;
        }

        .controls-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        /* Estilos da tabela */
        .professionals-table-container {
            overflow: auto;
            margin-top: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            max-height: 60vh;
            position: relative;
        }

        .professionals-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 700px;
        }

        .professionals-table thead {
            background: #f8f9fa;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .professionals-table th {
            padding: 8px;
            text-align: left;
            font-weight: 600;
            color: #2c3e50;
            border-bottom: 2px solid #dee2e6;
            vertical-align: top;
            background: #f8f9fa;
        }

        .header-column {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filter-input {
            width: 100%;
            padding: 5px;
            font-size: 12px;
            font-weight: normal;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .filter-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .professionals-table td {
            padding: 10px 8px;
            border-bottom: 1px solid #eee;
            vertical-align: middle;
        }

        .professionals-table tr:hover {
            background-color: #f8f9fa;
        }

        .professionals-table tr.selected {
            background-color: #e8f5e8;
        }

        .checkbox-cell {
            width: 40px;
            text-align: center;
        }

        .checkbox-cell input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .name-cell {
            font-weight: 500;
            color: #2c3e50;
        }

        .phone-cell {
            font-family: monospace;
            color: #666;
        }

        .selection-count {
            font-weight: 500;
            color: #1976d2;
            padding: 8px 12px;
            background: #e3f2fd;
            border-radius: 6px;
        }

        .filter-info {
            background: #fff3cd;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 10px;
            display: none;
        }

        .filter-info.show {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .filter-stats {
            font-size: 14px;
            color: #856404;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 6px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s;
            max-width: 400px;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            background: #28a745;
        }

        .toast.error {
            background: #dc3545;
        }

        .toast.info {
            background: #17a2b8;
        }

        .batch-config {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .batch-title {
            font-weight: bold;
            color: #495057;
            margin-bottom: 10px;
        }

        .batch-item {
            margin: 5px 0;
            font-size: 14px;
            color: #6c757d;
        }

        .progress-section {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            display: none;
        }

        .progress-title {
            font-weight: bold;
            color: #856404;
            margin-bottom: 10px;
        }

        .progress-item {
            margin: 5px 0;
            font-size: 14px;
            color: #856404;
        }

        .clear-filters-btn {
            padding: 5px 10px;
            font-size: 12px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .clear-filters-btn:hover {
            background: #c82333;
        }

        @media (max-width: 768px) {
            .controls-container {
                flex-direction: column;
                align-items: stretch;
            }
            
            .controls-left,
            .controls-right {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="flap-badge">MBL</div>
            <h1>Sistema de Convoca√ß√£o - MLB</h1>
            <p>Processamento em Lotes</p>
        </div>

        <!-- Dados da Demanda -->
        <div class="section">
            <div class="section-title">1. Dados da Demanda</div>
            <div class="form-grid">
                <div class="form-group">
                    <label for="evento">Evento:</label>
                    <input type="text" id="evento" placeholder="Nome do evento">
                </div>
                <div class="form-group">
                    <label for="local">Local:</label>
                    <input type="text" id="local" placeholder="Local do evento">
                </div>
                <div class="form-group">
                    <label for="data">Data:</label>
                    <input type="date" id="data">
                </div>
                <div class="form-group">
                    <label for="entrada">Hor√°rio de Entrada:</label>
                    <input type="time" id="entrada">
                </div>
            </div>
        </div>

        <!-- Loading -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <div>Carregando profissionais...</div>
        </div>

        <!-- Lista de Profissionais -->
        <div class="section" id="professionalsSection">
            <div class="section-title">2. Selecionar Profissionais</div>
            
            <!-- Controles na mesma linha -->
            <div class="controls-container">
                <div class="controls-left">
                    <button onclick="carregarProfissionais()" class="btn btn-primary">Carregar Profissionais</button>
                    <button onclick="selecionarTodos()" class="btn btn-secondary">Selecionar Todos</button>
                    <button onclick="desselecionarTodos()" class="btn btn-secondary">Desselecionar Todos</button>
                </div>
                <div class="controls-right">
                    <span class="selection-count" id="selectionCount">0 profissionais selecionados</span>
                    <button onclick="enviarConvocacao()" id="btnEnviarTopo" class="btn btn-success" disabled>
                        Enviar Convoca√ß√£o
                    </button>
                </div>
            </div>
            
            <!-- Info dos filtros -->
            <div class="filter-info" id="filterInfo">
                <span class="filter-stats" id="filterStats"></span>
                <button onclick="limparFiltros()" class="clear-filters-btn">
                    Limpar Filtros
                </button>
            </div>

            <div class="professionals-table-container">
                <table class="professionals-table" id="professionalsTable">
                    <thead>
                        <tr>
                            <th class="checkbox-cell" rowspan="2">
                                <input type="checkbox" id="selectAllCheckbox" onchange="toggleTodos()">
                            </th>
                            <th>
                                <div class="header-column">
                                    <span>NOME</span>
                                    <input type="text" 
                                           class="filter-input" 
                                           id="filterNome" 
                                           placeholder="Filtrar..."
                                           oninput="aplicarFiltros()">
                                </div>
                            </th>
                            <th>
                                <div class="header-column">
                                    <span>TELEFONE</span>
                                    <input type="text" 
                                           class="filter-input" 
                                           id="filterTelefone" 
                                           placeholder="Filtrar..."
                                           oninput="aplicarFiltros()">
                                </div>
                            </th>
                            <th>
                                <div class="header-column">
                                    <span>FUN√á√ÉO</span>
                                    <input type="text" 
                                           class="filter-input" 
                                           id="filterFuncao" 
                                           placeholder="Filtrar..."
                                           oninput="aplicarFiltros()">
                                </div>
                            </th>
                            <th>
                                <div class="header-column">
                                    <span>GERENTE</span>
                                    <input type="text" 
                                           class="filter-input" 
                                           id="filterGerente" 
                                           placeholder="Filtrar..."
                                           oninput="aplicarFiltros()">
                                </div>
                            </th>
                            <th>
                                <div class="header-column">
                                    <span>STATUS</span>
                                </div>
                            </th>
                        </tr>
                    </thead>
                    <tbody id="professionalsTableBody">
                        <!-- Profissionais ser√£o carregados aqui -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Configura√ß√£o dos Lotes -->
        <div class="section" id="batchSection" style="display: none;">
            <div class="section-title">3. Configura√ß√£o dos Lotes</div>
            <div class="batch-config">
                <div class="batch-title">Resumo do Processamento:</div>
                <div class="batch-item" id="batchInfo">
                    <!-- Info dos lotes ser√° inserida aqui -->
                </div>
            </div>
        </div>

        <!-- Progresso -->
        <div class="progress-section" id="progressSection">
            <div class="progress-title">Progresso do Envio:</div>
            <div id="progressList">
                <!-- Progress ser√° inserido aqui -->
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast"></div>

    <script>
        // Configura√ß√£o
        const GOOGLE_SHEETS_API_KEY = 'AIzaSyCCvdIC0TnINvn5s3TPwufzos-6sxZYFHk';
        const SPREADSHEET_ID = '1ML4LMfZSlqdZd_4JSYeSCwm3taHzaZ8UOTyex1V23XI';
        const SHEET_NAME = 'Profissionais_Aptos';
        const N8N_WEBHOOK_URL = 'https://n8n.hublanup.com.br/webhook/convocacao-sheets-seven7-mbl';
        const TAMANHO_LOTE_FIXO = 100; // Tamanho fixo do lote
        const EMPRESA_FIXA = 'MBL'; // Empresa fixa
        
        let profissionais = [];
        let selecionados = [];
        let lotes = [];
        let profissionaisFiltrados = [];

        // Carregar profissionais automaticamente na inicializa√ß√£o
        window.addEventListener('load', function() {
            document.getElementById('data').valueAsDate = new Date();
            setTimeout(() => {
                mostrarToast('Sistema de convoca√ß√£o MBL pronto', 'info');
            }, 500);
        });

        // Carregar profissionais da planilha
        async function carregarProfissionais() {
            document.getElementById('loading').classList.add('show');

            try {
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${SHEET_NAME}?key=${GOOGLE_SHEETS_API_KEY}`;
                
                const response = await fetch(url);
                const data = await response.json();

                if (data.error) {
                    throw new Error(data.error.message);
                }

                if (!data.values || data.values.length <= 1) {
                    throw new Error('Nenhum dado encontrado na planilha');
                }

                const headers = data.values[0];
                const rows = data.values.slice(1);

                profissionais = rows.map((row, idx) => ({
                    id: idx,
                    nome: row[0] || '',
                    telefone: row[1] || '',
                    funcao: row[2] || '',
                    gerente: row[3] || '',
                    status: row[4] || ''
                })).filter(p => p.nome && p.telefone);

                profissionaisFiltrados = [...profissionais];
                selecionados = [];

                renderizarTabelaProfissionais();
                mostrarToast(`${profissionais.length} profissionais carregados com sucesso`, 'success');

            } catch (error) {
                console.error('Erro ao carregar profissionais:', error);
                mostrarToast('Erro ao carregar profissionais: ' + error.message, 'error');
            } finally {
                document.getElementById('loading').classList.remove('show');
            }
        }

        // Aplicar filtros
        function aplicarFiltros() {
            const filtroNome = document.getElementById('filterNome').value.toLowerCase();
            const filtroTelefone = document.getElementById('filterTelefone').value.toLowerCase();
            const filtroFuncao = document.getElementById('filterFuncao').value.toLowerCase();
            const filtroGerente = document.getElementById('filterGerente').value.toLowerCase();

            const temFiltro = filtroNome || filtroTelefone || filtroFuncao || filtroGerente;
            
            // Mostrar/ocultar √°rea de filtros
            const filterInfo = document.getElementById('filterInfo');
            if (temFiltro) {
                filterInfo.classList.add('show');
            } else {
                filterInfo.classList.remove('show');
            }

            profissionaisFiltrados = profissionais.filter(prof => {
                return (!filtroNome || prof.nome.toLowerCase().includes(filtroNome)) &&
                       (!filtroTelefone || prof.telefone.includes(filtroTelefone)) &&
                       (!filtroFuncao || prof.funcao.toLowerCase().includes(filtroFuncao)) &&
                       (!filtroGerente || prof.gerente.toLowerCase().includes(filtroGerente));
            });

            // Atualizar selecionados para remover os que foram filtrados
            selecionados = selecionados.filter(id => 
                profissionaisFiltrados.some(prof => prof.id === id)
            );

            renderizarTabelaProfissionais();
            atualizarContador();
            atualizarBotaoEnviar();
            calcularLotes();

            // Atualizar estat√≠sticas do filtro
            const filterStats = document.getElementById('filterStats');
            if (temFiltro) {
                filterStats.textContent = `${profissionaisFiltrados.length} de ${profissionais.length} profissionais vis√≠veis ap√≥s filtro`;
            }
        }

        // Limpar todos os filtros
        function limparFiltros() {
            document.getElementById('filterNome').value = '';
            document.getElementById('filterTelefone').value = '';
            document.getElementById('filterFuncao').value = '';
            document.getElementById('filterGerente').value = '';
            aplicarFiltros();
        }

        // Renderizar tabela de profissionais
        function renderizarTabelaProfissionais() {
            const tbody = document.getElementById('professionalsTableBody');
            
            tbody.innerHTML = profissionaisFiltrados.map(prof => `
                <tr class="${selecionados.includes(prof.id) ? 'selected' : ''}" onclick="toggleProfissional(${prof.id})">
                    <td class="checkbox-cell">
                        <input type="checkbox" ${selecionados.includes(prof.id) ? 'checked' : ''} 
                               onchange="toggleProfissional(${prof.id})" 
                               onclick="event.stopPropagation()">
                    </td>
                    <td class="name-cell">${prof.nome}</td>
                    <td class="phone-cell">${formatarTelefone(prof.telefone)}</td>
                    <td>${prof.funcao}</td>
                    <td>${prof.gerente}</td>
                    <td>${prof.status || '-'}</td>
                </tr>
            `).join('');

            atualizarContador();
        }

        // Toggle sele√ß√£o de profissional
        function toggleProfissional(id) {
            const pos = selecionados.indexOf(id);
            if (pos > -1) {
                selecionados.splice(pos, 1);
            } else {
                selecionados.push(id);
            }
            
            atualizarVisualizacao();
        }

        // Toggle todos os profissionais vis√≠veis
        function toggleTodos() {
            const selectAll = document.getElementById('selectAllCheckbox');
            if (selectAll.checked) {
                selecionarTodos();
            } else {
                desselecionarTodos();
            }
        }

        // Selecionar todos os vis√≠veis
        function selecionarTodos() {
            // Adicionar apenas os IDs dos profissionais filtrados
            const idsFiltrados = profissionaisFiltrados.map(p => p.id);
            selecionados = [...new Set([...selecionados, ...idsFiltrados])];
            document.getElementById('selectAllCheckbox').checked = true;
            atualizarVisualizacao();
        }

        // Desselecionar todos
        function desselecionarTodos() {
            selecionados = [];
            document.getElementById('selectAllCheckbox').checked = false;
            atualizarVisualizacao();
        }

        // Atualizar visualiza√ß√£o
        function atualizarVisualizacao() {
            renderizarTabelaProfissionais();
            atualizarContador();
            atualizarBotaoEnviar();
            calcularLotes();
        }

        // Atualizar contador
        function atualizarContador() {
            document.getElementById('selectionCount').textContent = 
                `${selecionados.length} profissionais selecionados`;
        }

        // Atualizar bot√£o de enviar
        function atualizarBotaoEnviar() {
            const btnTopo = document.getElementById('btnEnviarTopo');
            btnTopo.disabled = selecionados.length === 0;
        }

        // Calcular lotes
        function calcularLotes() {
            if (selecionados.length === 0) {
                document.getElementById('batchSection').style.display = 'none';
                return;
            }

            const totalSelecionados = selecionados.length;
            const totalLotes = Math.ceil(totalSelecionados / TAMANHO_LOTE_FIXO);
            const tempoEstimado = Math.ceil(totalSelecionados * 15 / 60); // minutos

            // Dividir em lotes
            lotes = [];
            for (let i = 0; i < totalSelecionados; i += TAMANHO_LOTE_FIXO) {
                const loteIds = selecionados.slice(i, i + TAMANHO_LOTE_FIXO);
                const loteAtual = loteIds.map(id => profissionais.find(p => p.id === id));
                lotes.push(loteAtual);
            }

            // Mostrar informa√ß√µes dos lotes
            const batchInfo = document.getElementById('batchInfo');
            
            batchInfo.innerHTML = `
                <div>üè¢ <strong>Empresa:</strong> ${EMPRESA_FIXA}</div>
                <div>üìä <strong>Total de profissionais:</strong> ${totalSelecionados}</div>
                <div>üì¶ <strong>N√∫mero de lotes:</strong> ${totalLotes}</div>
                <div>‚è±Ô∏è <strong>Tempo estimado:</strong> ~${tempoEstimado} minutos</div>
            `;

            // Adicionar detalhamento dos lotes
            if (totalLotes > 1) {
                let detalhamento = '<div style="margin-top: 10px; font-size: 12px; color: #666;">';
                lotes.forEach((lote, i) => {
                    detalhamento += `<div>Lote ${i + 1}: ${lote.length} profissionais</div>`;
                });
                detalhamento += '</div>';
                batchInfo.innerHTML += detalhamento;
            }

            document.getElementById('batchSection').style.display = 'block';
        }

        // Formatar telefone
        function formatarTelefone(telefone) {
            if (!telefone) return '';
            const numeros = telefone.toString().replace(/\D/g, '');
            
            if (numeros.length === 11) {
                return `(${numeros.substring(0, 2)}) ${numeros.substring(2, 7)}-${numeros.substring(7)}`;
            }
            return telefone;
        }

        // Enviar convoca√ß√£o em lotes
        async function enviarConvocacao() {
            if (selecionados.length === 0) {
                mostrarToast('Selecione pelo menos um profissional', 'error');
                return;
            }

            // Validar dados da demanda
            const dadosDemanda = {
                empresa: EMPRESA_FIXA, // Sempre MBL
                evento: document.getElementById('evento').value.trim(),
                local: document.getElementById('local').value.trim(),
                data: document.getElementById('data').value,
                entrada: document.getElementById('entrada').value
            };

            if (!dadosDemanda.evento || !dadosDemanda.local || !dadosDemanda.data) {
                mostrarToast('Preencha todos os campos obrigat√≥rios da demanda', 'error');
                return;
            }

            calcularLotes(); // Garantir que os lotes est√£o calculados

            try {
                const btnTopo = document.getElementById('btnEnviarTopo');
                btnTopo.disabled = true;
                btnTopo.textContent = 'Enviando Lotes...';

                // Mostrar se√ß√£o de progresso
                const progressSection = document.getElementById('progressSection');
                const progressList = document.getElementById('progressList');
                progressSection.style.display = 'block';
                progressList.innerHTML = '';

                mostrarToast(`Iniciando envio de ${lotes.length} lotes para ${EMPRESA_FIXA}...`, 'info');

                // ENVIAR TODOS OS LOTES SIMULTANEAMENTE
                const promises = lotes.map(async (lote, i) => {
                    const numeroLote = i + 1;

                    // Adicionar item de progresso
                    const progressItem = document.createElement('div');
                    progressItem.className = 'progress-item';
                    progressItem.innerHTML = `üì¶ Lote ${numeroLote}/${lotes.length}: Enviando ${lote.length} profissionais...`;
                    progressList.appendChild(progressItem);

                    const payload = {
                        demanda: dadosDemanda,
                        profissionais: lote.map(p => ({
                            nome: p.nome,
                            telefone: p.telefone,
                            funcao: p.funcao,
                            gerente: p.gerente
                        })),
                        lote: numeroLote,
                        total_lotes: lotes.length,
                        sistema: 'seven7chat'
                    };

                    try {
                        const response = await fetch(N8N_WEBHOOK_URL, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(payload)
                        });

                        const result = await response.json();

                        if (response.ok && result.sucesso !== false) {
                            progressItem.innerHTML = `‚úÖ Lote ${numeroLote}/${lotes.length}: ${lote.length} profissionais enviados para processamento`;
                            progressItem.style.color = '#28a745';
                            return { sucesso: true, lote: numeroLote };
                        } else {
                            throw new Error(result.erro || 'Erro no processamento do lote');
                        }

                    } catch (loteError) {
                        console.error(`Erro no lote ${numeroLote}:`, loteError);
                        progressItem.innerHTML = `‚ùå Lote ${numeroLote}/${lotes.length}: Erro - ${loteError.message}`;
                        progressItem.style.color = '#dc3545';
                        return { sucesso: false, lote: numeroLote, erro: loteError.message };
                    }
                });

                // Aguardar TODOS os lotes terminarem
                const resultados = await Promise.all(promises);
                
                const sucessos = resultados.filter(r => r.sucesso).length;
                const erros = resultados.filter(r => !r.sucesso).length;

                if (sucessos === lotes.length) {
                    mostrarToast(`‚úÖ TODOS os ${lotes.length} lotes enviados com sucesso!`, 'success');
                } else {
                    mostrarToast(`‚ö†Ô∏è ${sucessos} lotes enviados, ${erros} com erro. Verifique o progresso acima.`, 'error');
                }

                // Limpar sele√ß√µes ap√≥s sucesso
                if (sucessos > 0) {
                    setTimeout(() => {
                        desselecionarTodos();
                        limparFiltros();
                    }, 3000);
                }

            } catch (error) {
                console.error('Erro geral no envio:', error);
                mostrarToast('‚ùå Erro no envio dos lotes: ' + error.message, 'error');
            } finally {
                const btnTopo = document.getElementById('btnEnviarTopo');
                btnTopo.disabled = false;
                btnTopo.textContent = 'Enviar Convoca√ß√£o';
                atualizarBotaoEnviar();
            }
        }

        // Mostrar toast
        function mostrarToast(mensagem, tipo = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = mensagem;
            toast.className = `toast ${tipo}`;
            toast.classList.add('show');

            setTimeout(() => {
                toast.classList.remove('show');
            }, 5000);
        }
    </script>
</body>
</html>
